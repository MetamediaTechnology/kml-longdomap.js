let kmlToLongdoMap=function(e,t,o={}){function n(e){let t=e[0],o=e[0];for(let n=0;n<e.length;n++)t<e[n]&&(t=e[n]),o>e[n]&&(o=e[n]);return{max:t,min:o}}function l(e){let t=[],o=!1,n=0;for(let l of e)o?t.push(l):(o=null===l,n++);return r(t)&&t.reverse(),e.splice(n),e=e.concat(t),e}function r(e=[]){let t=0,o=e.length-1;if(e.length>0){e[0].lat===e[e.length-1].lat&&e[0].lon===e[e.length-1].lon&&o--;for(let n=0;n<o+1;n++)t+=n===o?(e[0].lat-e[n].lat)*(e[0].lon+e[n].lon):(e[n+1].lat-e[n].lat)*(e[n+1].lon+e[n].lon)}return t>=0}function i(e){let t=e.geometry.type;switch(t){case"Point":p(e);break;case"Polygon":f(e);break;case"LineString":u(e);break;case"GeometryCollection":s(e);break;default:console.warn(t+" is not supported.")}}function a(e){if("string"==typeof e)return e=(new DOMParser).parseFromString(e,"text/xml"),e}function s(e){let t=e.geometry.geometries;for(let o of t){let t={geometry:o,properties:e.properties};i(t)}}function p(t){let n=t.geometry.coordinates,l=t.properties,r=n[0],i=n[1],a=new longdo.Marker({lon:r,lat:i},{title:l.name,detail:l.description,...o.markerOptions}),s=e.Overlays.add(a);m.Marker.push(s),h.push(n[0]),O.push(n[1])}function f(t){let n=t.geometry.coordinates,r=t.properties,i=d(r.stroke),a=d(r.fill),s={title:r.name,detail:r.description,lineWidth:1,...o.geometryOptions};g(i)&&(s.lineColor=g(i)),g(a,.4)&&(s.fillColor=g(a,.4));let p=2===n.length,f=[],u=0;for(let t of n){p?p&&f.length>0&&f.push(null):f=[];for(let e of t){let t=e[0],o=e[1];f.push({lon:t,lat:o}),h.push(t),O.push(o)}if(p){if(p&&1===u){f=l(f);let t=new longdo.Polygon(f,s),o=e.Overlays.add(t);m.Polygon.push(o)}}else{let t=new longdo.Polygon(f,s),o=e.Overlays.add(t);m.Polygon.push(o)}u++}}function u(t){let n=t.geometry.coordinates,l=t.properties,r=d(l.stroke),i={title:l.name,detail:l.description,lineWidth:1,...o.geometryOptions};g(r)&&(i.lineColor=g(r));let a=[];for(let e of n){let t=e[0],o=e[1];a.push({lon:t,lat:o}),h.push(t),O.push(o)}let s=new longdo.Polyline(a,i),p=e.Overlays.add(s);m.Polyline.push(p)}function g(e,t=1){let o=null;return null!==e&&(o=`rgba(${e.r}, ${e.g}, ${e.b}, ${t})`),o}function d(e){let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}o.hasOwnProperty("markerOptions")||(o.markerOptions={}),o.hasOwnProperty("geometryOptions")||(o.geometryOptions={});let m={Marker:[],Polygon:[],Polyline:[]};if(!e||"object"!=typeof e)throw new Error("Invalid Longdo Map object");if(!t||"string"!=typeof t)throw new Error("Unable to read KML.");if("undefined"==typeof toGeoJSON||"function"!=typeof toGeoJSON.kml)throw new Error("togeojson.js is not found.");t=a(t);let c=toGeoJSON.kml(t),y=c.features,h=[],O=[];for(let e of y)i(e);if(h.length>0&&O.length>0){let t=n(h),o=n(O);e.bound({minLon:t.min,minLat:o.min,maxLon:t.max,maxLat:o.max})}return m};